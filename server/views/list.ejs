<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>게시판 - 글 목록</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="/main.css" />
</head>
<body>
  <div class="wrapper">
    <h1>게시판</h1>

    <!-- 상단 유저 정보 / 로그아웃 -->
    <div class="card">
      <% if (user) { %>
        <p><strong><%= user.nickname %></strong>님 환영합니다.</p>
        <form action="/logout" method="POST" style="margin-top: 8px;">
          <button type="submit" class="btn">로그아웃</button>
        </form>
      <% } else { %>
        <p>로그인이 필요합니다.</p>
      <% } %>
    </div>

    <!-- 글 작성 카드 -->
    <div class="card">
     <button type="button" class="btn" id="write-btn">글 작성하기</button>

     <div id="write-form" style="display: none; margin-top: 12px;">
      <form action="/post" method="POST">
        <div class="field">
          <label for="title">제목</label>
          <input type="text" id="title" name="title" placeholder="제목을 입력하세요" required />
        </div>

        <div class="field">
          <label for="content">내용</label>
          <textarea id="content" name="content" placeholder="내용을 입력하세요" rows="5" required></textarea>
        </div>

        <button type="submit" class="btn">작성 완료</button>
      </form>
     </div> 
    </div>

    <!-- 글 목록 카드 -->
    <div class="card">
      <h1>글 목록</h1>

      <% if (posts && posts.length > 0) { %>
        <% posts.forEach(function(post) { %>
          <div class="field">
            <h3>
                <a href="/detail/<%= post._id%>" class="post-link"> 
                <%= post.title %>
                </a>
            </h3>
            <p><%= post.content %></p>
            <p class="sub-text">
              작성자: <%= post.authorName %> /
              작성일: <%= new Date(post.createdAt).toLocaleString('ko-KR') %>
            </p>
            <hr />
          </div>
        <% }) %>
      <% } else { %>
        <p>작성된 글이 없습니다. 첫 글을 작성해보세요!</p>
      <% } %>
    </div>
  </div>
  <script>
      document.addEventListener('DOMContentLoaded', function () {
      const btn = document.getElementById('write-btn');
      const formBox = document.getElementById('write-form');

      btn.addEventListener('click', function () {
        // 현재 숨겨져 있으면 보이게, 보이는 상태면 다시 숨기기
        if (formBox.style.display === 'none' || formBox.style.display === '') {
          formBox.style.display = 'block';
        } else {
          formBox.style.display = 'none';
        }
      });
    });
  </script>
</body>
</html>
