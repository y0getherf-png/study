<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>게시판</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="/main.css" />
</head>
<body>
  <div id="app" class="wrapper">
    <h1 id="title_name" :style="{ color: needLogin ? 'red' : '#000' }">
      {{ needLogin ? '로그인 해주세요' : '게시판 글 작성하기' }}
    </h1>

    <div class="row">
      <!-- 회원가입 카드 -->
      <div class="card">
        <h2>회원가입</h2>

        <form id="signup-form" action="/register" method="POST">
          <!-- 1) 처음에 보이는 버튼 -->
            <button
            type="button"
            id="open-signup"
            class="btn"
            @click="toggleSignup"
            v-if="!registered"
          >
            {{ showSignup ? '돌아가기' : '회원가입' }}
          </button>

          <!-- 2) 버튼을 누르면 나타날 입력창들 -->
          <div id="signup-fields" v-show="showSignup && !registered">
            <div class="field">
              <label for="signup-email">이메일</label>
              <input
                type="email"
                id="signup-email"
                name="signup_email"
                placeholder="example@example.com"
                required
                v-model="signupForm.email"
              />
            </div>

            <div class="field">
              <label for="signup-nickname">닉네임</label>
              <input
                type="text"
                id="signup-nickname"
                name="signup_nickname"
                placeholder="닉네임을 입력하세요"
                required
                v-model="signupForm.nickname"
              />
            </div>

            <div class="field">
              <label for="signup-password">비밀번호</label>
              <input
                type="password"
                id="signup-password"
                name="signup_password"
                placeholder="비밀번호를 입력하세요"
                required
                v-model="signupForm.password"
              />
            </div>

            <div class="field">
              <label for="signup-password2">비밀번호 확인</label>
              <input
                type="password"
                id="signup-password2"
                name="signup_password2"
                placeholder="비밀번호를 한번 더 입력하세요"
                required
                v-model="signupForm.password2"
              />
            </div>

            <button type="submit" class="btn">
              회원가입 완료
            </button>
        
            <p class="sub-text">
              ※ 회원가입 하세요
            </p>
          </div>
        </form>


            <!-- ★ 회원가입 완료 후에 보여줄 메시지 -->
          <p id="signup-complete" class="comp-text" v-if="registered">
          회원가입이 완료되었습니다. <br><br>로그인 해주세요.
          </p>
      </div>

      <!-- 로그인 카드 -->
      <div class="card">
        <h2>로그인</h2>

        <form id="login-form" action="/login" method="POST">
          <div class="field">
            <label for="login-email">이메일</label>
            <input type="email" id="login-email" name="login_email" placeholder="example@example.com" required />
          </div>

          <div class="field">
            <label for="login-password">비밀번호</label>
            <input type="password" id="login-password" name="login_password" placeholder="비밀번호를 입력하세요" required />
          </div>

          <button type="submit" class="btn">
            로그인
          </button>

          <p class="sub-text">
            ※ 로그인 하면 글목록 페이지로 이동합니다
          </p>
        </form>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/vue@2.7.16/dist/vue.js"></script>
  <script>
    new Vue({
      el: '#app',
      data:{
        showSignup: false,
        registered: false,
        needLogin: false,
        // 회원가입 input 들 (v-model 로 연결)
        signupForm: {
          email: '',
          nickname: '',
          password: '',
          password2: ''
        }
      },

      created() {
        const params = new URLSearchParams(window.location.search);
        const isRegistered = params.get('registered');
        const needLogin = params.get('login');

          if (needLogin === 'required') {
          this.needLogin = true;
          }
          if (isRegistered === '1') {
          // 회원가입 완료 후 리다이렉트된 상태
          this.registered = true;
          this.showSignup = false;
          }
        },
      methods: {
        toggleSignup() {
          this.showSignup = !this.showSignup;
        }
      }
    })
  </script>
</body>
</html>
